Central Logging
=================
>>script to trace /var/log/messages file
>>Run the script in the background
>>user/admin notification
>>Schedule the script through cronjob

this is a time about central logging.

This is one off the script that a lot of places have it in place and a lot of companies would like to have some kind of automation tool around the logging.
how it works is you have a really nice machine, has Warralong messages.Right.

And you would actually have to go into the machine, log into the machine to view those those logs and to see if they are any error messages or failures or anything.

So you you probably would have to do that multiple times if you have multiple servers or if you haveto do probably four thousand times if you are thousands of servers and you have to go and buy the filetested so many things.

What if I tell you, you could write a script, a central logger script, what it's going to do, it's going to trace the wire log messages?
Well, not just trace like an entire file.

It actually is going to sit and wait for the new line generation to log in to the wire log messages.And as soon as it comes in, it is actually going to filter out whether it has error messages or not. And it's going to put it out if it matches your criteria.

If you are looking for only, let's say, error messages or failures, then it's only going to grab for that keywords.
And once it finds those keywords is going to push that out to a file.

And you could read the file later on by yourself or then or you could actually leave that script to run it in the background while it's running its keep outputting your error messages or your failures related lines from your log messages to a file, and then you could go in and read it.

And you just have to do is run in the background or you could third step.

You could do as you could.

As soon as those file is created, you could create another script and tell if it's going to wake uplike every 15 minutes or 20 minutes and tell the users or administrators or managers that, hey, there is this file that's been generated and it has these many errors and failures are of course, you could go another step, which is to schedule their script through the CRONJOB.

So if you look at it backward, you have a script that is scheduled to wake up every 15 minutes.That script will have to notify a user if a file exists.

And that file that exists, that has your information that you're looking for, like errors, failures shut down offline or anything that you have specified.

And those messages are coming from where?

From Warralong messages.

So we will create the script.

It's a little long.

Squaresville create the script step by step, and you could actually implement that script in your job

if you are at Lennix capacity right now.

And you will see definitely that this has this will make your life so much easier when you actually

have these error messages coming in through the email without you having to log into every machine.
========================================================================================================================================

Trace the log file:

vi /root/logtail

#!/bin/bash

tail -fn0 /var/log/messages | while read line

do
	echo $line | egrep -i "refused|invalid|error|fail|lost|shut|down|offline"

        if [ $? = 0 ]

        then
	
        echo $line >> /tmp/filtered-messages

        fi

done



--------------------------------------------------------------------





Run script in the background:



nohup /root/logtail &&


--------------------------------------------------------------------





Notification:



vi 

/root/Log-Alert




#!/bin/bash

systems="imran_ny@hotmail.com,charles.gorden@email.com"
if [ -s /tmp/filtered-messages ]

        then

        cat /tmp/filtered-messages | sort | uniq | mail -s "CHECK: Syslog Errors" $systems

        rm /tmp/filtered-messages

        else
	
        fi




--------------------------------------------------------------------




Schedule the Notification to run every 15 minutes:



*/15 * * * * /root/Log-Alert
